---
title: "暴露边缘服务设计和示例实现"
date: 2022-07-23T22:10:05+08:00
draft: true
toc: true
comments: true
tags:
  - untagged
---

## 需求说明

在典型的微后端场景中，项目会被拆成多个可以独立运行的微服务，这些服务会通过相关协议（如 http/protobuf/thrift）相互调用。在实现上，这些服务一般会通过暴露 TCP 端口的方式提供服务。

这在网络层面隐含了一个假设：服务间的网络必须是双向可通的，即这些服务需要在同一个内网。这个假设在一般的机房内部很容易实现，但是在很多场景中，服务不一定是部署在同一个机房中，这就涉及了跨网络调用的问题。

本文设想一个场景：一个项目包含多个服务，这些服务可以分为两种类型：

* 核心服务：部署于同一个数据中心的核心。
* 边缘服务：部署于任意网络环境中的边缘设备，简单起见，该服务只有一个实例。

在网络上，边缘服务可以单向访问核心服务，但是核心服务不能单向访问边缘服务（因为边缘服务没有公网 IP）。

具体而言，可以理解为一个简化版的 IoT 设备和后端服务相互调用的场景。

希望达到的效果是：一旦边缘服务上线，核心服务可以直接调用运行在边缘设备上的边缘服务，就像两者运行在同一个内网上的微服务一样。

## 概念和架构设计

## 相关技术和示例代码

### Websocket

### 多路复用技术

### 示例代码

参见：github [rectcircle/expose-edge-service-demo](https://github.com/rectcircle/expose-edge-service-demo)
